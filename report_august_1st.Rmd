---
title: 'report'
format: word_document
---

Hi Brian and Fiona - here's me trying to figure out how to do this!

I decided to go back to the drawing board a bit and sanity check every step of the way.
Starting with example data:

```{R}
set.seed(123)

x <- seq(0, 10, by = 0.1)
y <- 100 * (1 - exp(-0.2 * x))^3 + rnorm(length(x), sd = 5)

G <- function(pars) {
  pars['a'] * (1 - exp(-pars['b'] * x))^pars['c']
}

neg_log_likelihood <- function(pars) {
  -sum(dnorm(y, G(pars), sd = 1, log = TRUE))
}

optim(par = c(a = 1, b = 1, c = 1), fn = neg_log_likelihood)
```

Behaves as expected, so far so good.

Now I load in the data and check it out

```{R} 
all_data_csv <- readRDS('santoro_ESA_alldata.rds')
head(all_data_csv)

x <- all_data_csv$age
y <- all_data_csv$agbd

G <- function(pars) {
  pars['a'] * (1 - exp(-pars['b'] * x))^pars['c']
}

neg_log_likelihood <- function(pars) {
  -sum(dnorm(y, G(pars), sd = 1, log = TRUE))
}

optim(par = c(a = 1, b = 1, c = 1), fn = neg_log_likelihood)

```







##########################


# Set the seed for reproducibility
set.seed(123)

# Generate fake data
x <- seq(0, 10, by = 0.1)
y <- 100 * (1 - exp(-0.2 * x))^3 + rnorm(length(x), sd = 5)

# Define the Chapman-Richards growth model
chapman_richards <- function(x, a, b, c) {
  a * (1 - exp(-b * x))^c
}

# Define the negative log-likelihood function
NLL <- function(pars) {
  # Extract the parameters
  a <- pars[1]
  b <- pars[2]
  c <- pars[3]
  sd <- pars[4]

  # Compute the model predictions
  y_pred <- chapman_richards(x, a, b, c)

  # Compute the negative log-likelihood
  -sum(dnorm(y, mean = y_pred, sd = sd, log = TRUE))
}

# Set the initial values for the parameters
pars_init <- c(a = 10, b = 0.01, c = 1, sd = 5)

# Maximize the negative log-likelihood using nlm
fit <- nlm(NLL, p = pars_init)

# Print the estimated parameters
fit$estimate
